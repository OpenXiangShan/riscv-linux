/include/ "xiangshan-base.dtsi"

// TODO: fix at lot of binding errors

/ {
	compatible = "xiangshan,fpga";
	model = "XiangShan FPGA";

	chosen {
		bootargs = "root=/dev/nvme0n1p2 rootfstype=ext4 rw rootwait console=ttyS0,115200n8 earlycon noinitrd";
	};

	memory: memory@80000000 {
		device_type = "memory";
		reg = <0x0 0x80000000 0x2 0x00000000>;
	};
};

&cpus {
	timebase-frequency = <500000>; // CLINT timer at 500 KHz
	// adjust XiangShan/src/main/scala/device/TLTimer.scala:42
};

&cpu0 {
	clock-frequency = <1000000>; // 1 MHz
};

&cpu1 {
	clock-frequency = <1000000>; // 1 MHz
	status = "okay";
};

&soc {
	clkc: misc_clk_0 {
		#clock-cells = <0>;
		clock-frequency = <25000000>;
		compatible = "fixed-clock";
	};

	wdt_clkc: wdt_clock {
		#clock-cells = <0>;
		clock-frequency = <50000000>;
		compatible = "fixed-clock";
	};

	debug-controller@0 {
		compatible = "sifive,debug-013", "riscv,debug-013";
		interrupts-extended = <&cpu0_intc 65535>;
		reg = <0x0 0x0 0x0 0x1000>;
		reg-names = "control";
	};

	ethernet1: ethernet@31010000 {
		compatible = "st,stm32-dwmac", "snps,dwmac-3.50a";
		reg = <0 0x31010000 0 0x10000>;
		reg-names = "stmmaceth";
		interrupts = <3 2 1>;
		interrupt-names = "eth_lpi", "macirq", "eth_wake_irq";
		clock-names = "stmmaceth";
		clocks = <&clkc>;
		//st,syscon = <&syscfg 0x4>;
		snps,pbl = <2>;
		snps,mixed-burst;
		phy-mode = "rgmii";
		// stmmac driver can not find phy if add this node
		//
		phy-handle = <&phy>;
		mdio {
			#address-cells = <0x1>;
			#size-cells = <0x0>;
			phyaddr = <0x7>;
			compatible = "snps,dwmac-mdio";
			phy: phy@7 {
				//phyaddr = <0x7>;
				//compatible = "marvell,88e1116r";
				//device_type = "ethernet-phy";
				reg = <0x7>;
			};
		};
	};

	xdma_pl_0: axi-pcie@40000000 {
		#address-cells = <3>;
		#interrupt-cells = <1>;
		#size-cells = <2>;
		compatible = "xlnx,xdma-host-3.00";
		device_type = "pci";
		interrupt-map =	<0x0 0 0 1 &pcie_intc_0 1>,
				<0x0 0 0 2 &pcie_intc_0 2>,
				<0x0 0 0 3 &pcie_intc_0 3>,
				<0x0 0 0 4 &pcie_intc_0 4>;
		interrupt-map-mask = <0x0 0 0 7>;
		interrupt-names = "misc", "msi0", "msi1";
		interrupts = <53 52 51>;
		ranges = <0x02000000 0x00000000 0x50000000 0x0 0x50000000 0x00000000 0x10000000>;
		reg = <0x00000000 0x40000000 0x0 0x10000000>;
		pcie_intc_0: interrupt-controller {
			#address-cells = <0>;
			#interrupt-cells = <1>;
			interrupt-controller ;
		};
	};

	qspi: spi@31000000 {
		compatible = "cdns,qspi-nor";
		#address-cells = <1>;
		#size-cells = <0>;
		reg = <0x0 0x31000000 0x0 0x1000>,
			<0x0 0x10000000 0x0 0x10000000>;
		interrupts = <44>;
		cdns,fifo-depth = <128>;
		cdns,fifo-width = <4>;
		cdns,trigger-address = <0x10000000>;
		clocks = <&clkc>;
		status = "okay";

		flash0: mt25qu512a@0 {
			#address-cells = <1>;
			#size-cells = <1>;
			compatible = "micron,mt25qu512a", "jedec,spi-nor";
			reg = <0>;	/* chip select */
			spi-max-frequency = <10000000>;

			m25p,fast-read;
			cdns,page-size = <256>;
			cdns,block-size = <16>;
			cdns,read-delay = <0>;
			cdns,tshsl-ns = <0>;
			cdns,tsd2d-ns = <0>;
			cdns,tchsh-ns = <0>;
			cdns,tslch-ns = <0>;
		};
	};

	sdhci2: sdhci@30050000 {
		compatible = "snps,dwcmshc-sdhci";
		reg = <0 0x30050000 0 0x10000>;
		interrupts = <55 56>;
		clocks = <&clkc>;
		clock-names = "core";
		//sd-uhs-sdr12;
		no-1-8-v;
		disable-wp;
		bus-width = <4>;
		max_req_size = <4096>;
		status = "disabled";
	};

	gpio0: gpio@31110000 {
		compatible = "snps,dw-apb-gpio";
		reg = <0 0x31110000 0 0x10000>;

		porta: gpio-controller@0 {
			compatible = "snps,dw-apb-gpio-port";
			reg = <0>;
			gpio-controller;
			#gpio-cells = <2>;
			snps,nr-gpios = <32>;
			interrupt-controller;
			interrupt-parent = <&plic>;
			interrupts = <5  6  7  8  9  10 11 12
				      13 14 15 16 17 18 19 20
				      21 22 23 24 25 26 27 28
				      29 30 31 32 33 34 35 36>;
		};
	};

	watchdog@31130000 {
		compatible = "snps,dw-wdt";
		reg = <0x0 0x31130000 0x0 0x10000>;
		interrupts = <46>;
		clocks = <&wdt_clkc>;
		snps,watchdog-tops = <0x0001000 0x0002000 0x0004000 0x0008000
				      0x0010000 0x0020000 0x0040000 0x0080000
				      0x0100000 0x0200000 0x0400000 0x0800000
				      0x1000000 0x2000000 0x4000000 0x8000000>;
	};

	uart0: serial@310b0000 {
		compatible = "ns16550a";
		reg = <0x0 0x310b0000 0x0 0x10000>;
		reg-shift = <0x02>;
		reg-io-width = <0x04>;
		interrupts = <40>;
		clock-frequency = <50000000>;
	};
};
